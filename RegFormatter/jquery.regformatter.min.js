(function(n){function t(i,r){var u=this,e;if(i&&i.tagName.toUpperCase()!=="INPUT"&&i.tagName.toUpperCase()!=="TEXTAREA")throw"Element should be <input />";if(!r.format&&!r.formats)throw"Format is not specified";this.element=i;e=r.formats||[];r.format&&e.unshift(r.format);this.reset(e);var f,o=function(n){var e,i,o,r;if(u.element&&(f=t.getCaretPosition(u.element),n=n||window.event,e=n.keyCode||n.charCode,e===8||e===46)){if(!u.element.value)return;i=f.selectionStart;o=f.selectionEnd;i===o&&(e===8?i--:o=i+1);r=u.write("",u.element.value,i,o);r&&(t.preventEvent(n),u.element.value=r.value,u.oldValue=r.value,t.setCaretPosition(u.element,r.position))}},s=function(n){var i;if(u.element&&(n=n||window.event,!n.ctrlKey&&(!n.key||!(n.key.length>1))&&(n.keyCode||n.charCode)!==13)){if(n.which==null)i=String.fromCharCode(n.keyCode);else if(n.which!==0&&n.charCode!==0)i=String.fromCharCode(n.which);else return;if(i){f=t.getCaretPosition(u.element);var e=f.selectionStart,o=f.selectionEnd,r=u.write(i,u.element.value,e,o===e?null:o);r&&(u.element.value=r.value,u.oldValue=r.value,t.setCaretPosition(u.element,r.position));t.preventEvent(n)}}},h=function(n){var i;if(u.element&&(n=n||window.event,f=t.getCaretPosition(u.element),t.preventEvent(n),i=n.data,console.log(i),i)){var e=f.selectionStart,o=f.selectionEnd,r=u.write(i,u.element.value,e,o===e?null:o);r&&(u.element.value=r.value,u.oldValue=r.value,t.setCaretPosition(u.element,r.position))}},c=function(){var i,r,n;if(u.element){f||(f=t.getCaretPosition(u.element));i=f.selectionStart;r=f.selectionEnd;f=null;var e=u.oldValue||"",s=e.substring(0,i),h=e.substring(r),o=u.element.value.substring(s.length);o=o.substring(0,o.length-h.length);n=u.write(o,e,i,r===i?null:r);n?(u.element.value=n.value,u.oldValue=n.value,t.setCaretPosition(u.element,n.position)):u.element.value=e}},l=function(n){var i,e;if(u.element&&(n=n||window.event,f=t.getCaretPosition(u.element),i=n.clipboardData||window.clipboardData,i&&i.getData)){if(e=i.getData("text/plain"),e){var o=f.selectionStart,s=f.selectionEnd,r=u.write(e,u.element.value,o,s===o?null:s);r&&(u.element.value=r.value,u.oldValue=r.value,t.setCaretPosition(u.element,r.position))}t.preventEvent(n)}},a=function(){if(u.element){f=t.getCaretPosition(u.element);var i=f.selectionStart,r=f.selectionEnd,n=u.write("",u.element.value,i,r===i?null:r);n&&setTimeout(function(){u.element.value=n.value;u.oldValue=n.value;t.setCaretPosition(u.element,n.position)},10)}};if(i)n(i).on("keydown",o).on("keypress",s).on("beforeinput",h).on("input",c).on("paste",l).on("cut",a);t.prototype.destroy=function(){var t=this;t.element&&n(t.element).off("keydown",o).off("keypress",s).off("beforeinput",h).off("input",c).off("paste",l).off("cut",a);t.formats=null;t.patterns=null;t.oldValue=null;t.element=null;delete t.formats;delete t.patterns;delete t.oldValue;delete t.element;delete t}}Array.prototype.indexOf||(Array.prototype.indexOf=function(n,t){for(var i=t||0;i<this.length;i++)if(this[i]===n)return i;return-1});Array.isArray||(Array.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"});var i=function(n){for(var i="",t=0;t<n.length;t++)i+=n[t].value;return i};t.preventEvent=function(n){n&&(n.preventDefault?n.preventDefault():n.returnValue=!1)};t.getCaretPosition=function(n){if(!n)return null;if(document.selection){n.focus();var t=document.selection.createRange(),i=t.text.length;return t.moveStart("character",-n.value.length),{selectionStart:t.text.length-i,selectionEnd:t.text.length}}return{selectionStart:n.selectionStart,selectionEnd:n.selectionEnd}};t.setCaretPosition=function(n,t){if(n&&t!==null)if(n.setSelectionRange)n.focus(),n.setSelectionRange(t,t);else if(n.createTextRange){var i=n.createTextRange();i.collapse(!0);i.moveEnd("character",t);i.moveStart("character",t);i.select()}};t.prototype.reset=function(n){var v=[],p,r,ft,c,l,o,d,a,w,g,b,nt,tt;if(typeof n=="string")v.push(n);else if(Array.isArray(n))v=n.concat();else throw"Invalid argument 'format'";var et=[".","[","]","(",")","+","-","*","?","{","}","|","/","^","$"],it=["%","[","(","{"],rt=["%","]",")","}"],ot=["+","*","|","^","$"],st=["{","?"],h=[],e=[],t="",u=!1,y=!1,f=[],k="",i,s=function(r){t===""||r&&(f.length>1||i+1<n.length&&st.indexOf(n.charAt(i+1))>=0)||(e.push({value:t,isExp:r}),k+=t,t="")},ut=function(n,t,i){for(var r,f,s,e,v,o,y,c,l,a,u=t;u>=0;u--)if(r=n[u],r.isExp&&Array.isArray(r.value)){for(f=0;f<r.value.length;f++){for(s=Array.isArray(r.value[f])?r.value[f]:[r.value[f]],e=0;e<s.length;e++)s[e].value===""&&(s.splice(e,1),e--);ut(n,u-1,s.concat(i))}break}else i.unshift(r);if(u<=0){for(v=!1,o=0;o<h.length;o++)if(h[o].length===i.length){for(y=!0,c=0;c<h[o].length;c++)l=h[o][c],a=i[c],l.isExp===a.isExp&&l.value.length===a.value.length&&l.value===a.value||(y=!1);if(y){v=!0;break}}v||h.push(i)}};for(p=0;p<v.length;p++){if(n=v[p],n==="*"){h.push([{value:".*",isExp:!0}]);continue}for(e=[],t="",u=!1,y=!1,f=[],k="",i=0;i<n.length;i++){if(r=n.charAt(i),y){t+=r;y=!1;s(u);continue}if(r==="\\"){t+=r;y=!0;continue}if(r==="%")if(u)if(f.length&&f[f.length-1]==="%"){f.pop();s(u);u=!1;continue}else throw"Invalid pattern '"+n+"' at position "+i+" '"+r+"'";else{f.push(r);s(u);u=!0;continue}if(!u){t+=et.indexOf(r)>=0?"\\"+r:r;s(u);continue}if(it.indexOf(r)>=0){f.push(r);t+=r;s(u);continue}if(rt.indexOf(r)>=0)if(f.length&&f[f.length-1]===it[rt.indexOf(r)]){f.pop();t+=r;s(u);continue}else throw"Invalid pattern '"+n+"' at position "+i+" '"+r+"'";if(ot.indexOf(r)>=0){t+="\\"+r;s(u);continue}t+=r;s(u)}if(f.length)throw"Invalid pattern '"+n+"' at position "+(n.length-1)+" '"+n[n.length-1]+"'";for(ft=new RegExp(k),ft=null,i=0;i<e.length;i++)if(t=e[i],t.isExp)if(c=/\{(\d)\}$/,l=c.exec(t.value),l){for(o=parseInt(l[1]),t.value=t.value.replace(c,""),e.splice(i,1),d=0;d<o;d++)e.splice(i,0,t);i+=o-1}else if(/(^|[^\\])\{(\d)\}/.test(t.value))throw"Invalid pattern '"+n+"' in '"+t.value+"'";for(i=0;i<e.length;i++)if(t=e[i],t.isExp)if(/[^\\]\{(\d+),(\d+)\}$/.test(t.value)){if(c=/\{(\d+),(\d+)\}$/,l=c.exec(t.value),a=parseInt(l[1]),w=parseInt(l[2]),!a||!w||a<1||a>w)throw"Invalid pattern '"+n+"' in '"+t.value+"'";if(t.value=t.value.replace(c,""),!t.value)throw"Invalid pattern '"+n+"' in '"+t.value+"'";for(g=[],b=[],o=0;o<a-1;o++)b.push(t);for(o=a;o<=w;o++)b.push(t),g.push(b.concat());e.splice(i,1,{value:g,isExp:t.isExp})}else if(/[^\\]\?$/.test(t.value))t.value=t.value.replace(/\?$/,""),e.splice(i,1,{value:[{value:"",isExp:t.isExp},t],isExp:t.isExp});else if(/(^|[^\\])(\{(\d+),(\d+)\})|\?/.test(t.value))throw"Invalid pattern '"+n+"' in '"+t.value+"'";ut(e,e.length-1,[])}this.formats=v;this.patterns=h;this.element&&(nt=this.element.value,nt&&(tt=this.write(nt,"",0,0),this.element.value=tt?tt.value:"",this.oldValue=this.element.value))};t.prototype.value=function(n){var u=this,f="",t,r,e;if(n=n!=undefined?n:this.element?this.element.value:"",!n)return"";for(r=null,t=0;t<u.patterns.length;t++){if(u.patterns[t].length===1&&u.patterns[t][0].isExp&&u.patterns[t][0].value===".*")return n;if(r=u.patterns[t].slice(0,n.length),new RegExp("^"+i(r)+"$").test(n))break;else r=null}if(!r)return null;for(t=0;t<r.length;t++)r[t].isExp&&(e=n.match(new RegExp("^"+i(r.slice(0,t+1)))),f+=e[0].replace(new RegExp("^"+i(r.slice(0,t))),""));return f};t.prototype.write=function(n,t,r,u){var c=this.value(t||""),l,a,o,v,k,y,f,h,d,w,g,b;if(typeof c=="undefined"||c===null||!c&&!n)return{value:"",position:0};if(u?(o=this.value(t.substring(0,r)),v=this.value(t.substring(0,u)),k=c.substring(v.length),l=o+n+k,a=o.length):(o=this.value(t.substring(0,r)),v=c.substring(o.length),l=o+n+v,a=o.length),!l)return{value:l||"",position:a};for(y=0;y<this.patterns.length;y++){var s=this.patterns[y],e=l,p=a;if(s.length===1&&s[0].isExp&&s[0].value===".*")return{value:e,position:p+n.length};for(f=1,h=0;h<s.length;h++){for(d=s.slice(0,h+1),w=null;f<=e.length;)if(g=e.substring(0,f),w=new RegExp("^"+i(d)+"$").exec(g),w){f++;break}else if(s[h].isExp){f++;continue}else{b=s[h].value.replace(/^\\/,"");e=e.substring(0,f-1)+b+e.substring(f-1);f<p+n.length+b.length&&(p+=b.length);continue}if(f>e.length){if(w)return{value:e,position:p+n.length};break}}}return null};n.fn.regformatter=function(i){return i&&this.each(function(){var r=n(this).data("regformatter")||!1;r&&r.destroy&&typeof r.destroy=="function"&&r.destroy();r=new t(this,i);n(this).data("regformatter",r)}),this.value=function(t){var r,i;return this.length>1?(r=[],this.each(function(){var i=n(this).data("regformatter")||!1;i&&i.value&&typeof i.value=="function"&&r.push(i.value(t))}),r):this.length===1&&(i=n(this).data("regformatter")||!1,i&&i.value&&typeof i.value=="function")?i.value(t):null},this.write=function(t,i,r,u){var e,f;return this.length>1?(e=[],this.each(function(){var f=n(this).data("regformatter")||!1;f&&f.write&&typeof f.write=="function"&&e.push(f.write(t,i,r,u))}),e):this.length===1&&(f=n(this).data("regformatter")||!1,f&&f.write&&typeof f.write=="function")?f.write(t,i,r,u):null},this}})(jQuery);
//# sourceMappingURL=jquery.regformatter.min.js.map
